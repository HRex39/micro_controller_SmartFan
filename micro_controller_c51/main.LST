C51 COMPILER V9.00   MAIN                                                                  12/23/2020 11:28:11 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\Keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //SmartFan
   2          //HRex 2020/12/23
   3          #include <reg52.h>
   4          typedef unsigned char uint8;
   5          typedef unsigned int uint16;
   6          
   7          uint8 Buf[]="hello world!\n";
   8          uint8 Received_Buf[50] = '0';
   9          uint16 num = 0;
  10          //Fans
  11          sbit IN3 = P0^0;
  12          sbit IN4 = P0^1;
  13          sbit ENB = P0^2;
  14          //Light
  15          sbit L1 = P1^0;
  16          sbit L2 = P1^1;
  17          sbit L3 = P1^2;
  18          sbit L4 = P1^3;
  19          //LED
  20          sbit LED_DIN = P1^5;
  21          sbit LED_CS = P1^6;
  22          sbit LED_CLK = P1^7;
  23          //KeyBoard
  24          sbit K1 = P3^2;
  25          sbit K2 = P3^3;
  26          sbit K3 = P3^6;
  27          sbit K4 = P3^7;
  28          
  29          void delay(uint16 n) {
  30   1        uint16 x,y;
  31   1        for (x=n;x>0;x--)
  32   1              for (y=114;y>0;y--);
  33   1      }
  34          
  35          void UART_Init() {
  36   1        TMOD = 0x20;
  37   1        TMOD = 0x20; //定时器0工作模式2，自动重装8位计数器
  38   1        TH1 = 0xfd;
  39   1        TL1 = 0xfd;//定时器溢出时，会自动将高8位中的值赋值给低8位.比特率9600
  40   1        TR1 = 1;
  41   1        SM0 = 0;
  42   1        SM1 = 1;
  43   1        REN = 1;
  44   1        EA = 1;
  45   1        ES = 1;
  46   1      }
  47          
  48          /*发送一个字符*/
  49          void UART_send_byte(uint8 dat) {
  50   1        SBUF = dat;           //把数据放到SBUF中
  51   1        while (TI == 0);              //未发送完毕就等待
  52   1        TI = 0;                       //发送完毕后，要把TI重新置0
  53   1      }
  54           
  55          /*发送一个字符串*/
C51 COMPILER V9.00   MAIN                                                                  12/23/2020 11:28:11 PAGE 2   

  56          void UART_send_string(uint8 *buf) {
  57   1        while (*buf != '\0') {
  58   2          UART_send_byte(*buf++);
  59   2        }
  60   1      }
  61          
  62          void UART() interrupt 4 {
  63   1        if(RI == 1) {
  64   2          
  65   2              int i = 0;//计数器
  66   2              num = SBUF;  //取出数据
  67   2              while (num != '!') {
  68   3                Received_Buf[i] = num;
  69   3                RI = 0;
  70   3                delay(1);
  71   3                num = SBUF;
  72   3                i++;    
  73   3              }
  74   2              Received_Buf[i] = '!'; 
  75   2              RI = 0;
  76   2              //num = SBUF;  //取出数据
  77   2              //RI = 0;
  78   2      
  79   2      
  80   2      
  81   2      
  82   2              UART_send_string(Received_Buf);
  83   2              for (i=49;i>0;i--)
  84   2                Received_Buf[i] = 0;
  85   2              delay(100);
  86   2        }
  87   1        //如果发送完毕
  88   1        if(TI == 1) {                                                    
  89   2          TI = 0;       //清除标志位
  90   2        }
  91   1      }
  92          
  93          void main() {
  94   1              
  95   1        UART_Init();
  96   1        while (1) {
  97   2          L1 = 0;
  98   2        
  99   2        
 100   2        }     
 101   1      
 102   1      
 103   1      }
 104          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    273    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     66       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
